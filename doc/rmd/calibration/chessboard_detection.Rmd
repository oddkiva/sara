# Chessboard Based Calibration

This approach assumes that we know the camera model, and aims at optimizing the
parameters associated to the camera model by exploiting correspondences between
the 2D image points and its corresponding 3D scene points of the x-corners of
the chessboard.

One task is to detect the chessboard x-corners. As deceptively simple as the
chessboard may be, this computer vision task can turn unexpectedly challenging
when we are faced with unexpected imaging conditions.

What really makes the detection of the chessboard hard are the following
issues:

- the motion blur,  due to sudden movement during the filming process.
- a sudden exposure to the sun while filming the chessboard can drastically
change the lighting conditions,
- a dirty camera lens, which then creates lots of signal noise to be filtered
out.
- a dirty or damaged chessboard pattern, which also creates lots of signal noise

These are what complicates the design of a reliable chessboard detection
algorithm.

In this book, I will present my chessboard detection algorithm and my personal
recipes that I have employed to detect chessboards reliably.

Alternative chessboard detection algorithms available online:

- OpenCV provides one and designed by Vezhnevets et al, and later improved by
  Scaramuzza, Rufli et al. It can work very well on easy conditions. However, it
  is not always possible the conditions under which the video data is acquired.
  This becomes a major issue when business ship software to clients who know
  very little about computer vision and expect the algorithms to just work.

  In challenging lighting conditions, OpenCV’s method will tend to break. Most
  annoyingly, it requires the chessboard to be visible in full and will not even
  output a partially detected chessboard. With the default parameters, the
  chessboard detector becomes slow to the point of being unusable especially
  when the chessboard is not visible in the images. While we can speed up
  OpenCV’s algorithm with a faster check option, it will tend to miss the
  chessboard.
- libcbdetect is designed by Geiger et al. and turns out to be a strong and
  robust alternative. It it can still fail very badly under challenging
  conditions.
- BoofCV also provides a chessboard detection algorithm and outperforms
  libcbdetect according to the author of the library Abeles.

Initially, I wanted to design a new chessboard detector in order not to depend
on `OpenCV` and I still wanted to investigate myself whether I could come out
with a good enough alternative. `libcbdetect` could have been an excellent
choice, unfortunately its GPL-licensing made it a no-go for me. I decided to not
use `BoofCV` since I don’t program in Java.

Let us distinguish OpenCV's method and the other methods.

OpenCV’s method depends on the adaptive Gaussian thresholding method to binarize
the image. It then localizes the chessboard black squares by iterative
morpohological erosion. Let us discuss the merits and disadvantages of such
approach.
First, while very simple and computationally efficient approach, the adaptive
thresholding tends to fail at providing a satisfactory image binarization on
challenging lighting conditions. Second, the repeated use of the morphological
erosion to separate and distinguish black squares is both ingeneous and
awkward at the same time. This entails finding a compromise between localizing
all the chessboard black squares and the accuracy in the localization of
chessboard x-corners.

The other approaches instead base themselves on the robust detection of
x-corners and then performs a structure recovery via a region growing approach.
One very attractive feature is that they can detect multiple chessboards in the
images contrary to OpenCV.
Relying on corner detection works better against to challenging lighting
condition. However because they don't detect the chessboard squares and don't
exploit the topological structure of the chessboard as much as in OpenCV's
method, they may still fail at correctly recover the grid structure of the
chessboard.


In my approach, I still rely on a good corner detector. By filtering the edges
and parsing them, it is possible to recover both black and white squares of the
chessboard. This will greatly ease the recovery of the grid structure, which is
proceeded by region growing as well. Instead of relying on the geometric
constraints as in Geiger et al. approach, will fail badly to recover the grid
structure on tricky cases.

### Chessboard Calibration Method

I have devised a chessboard detection algorithm that is designed to work well on
HD resolution and above 4K resolutions without any parameter tuning.
Such image resolution are pretty much standard in consumer cameras, such as
GoPro. For resolution lower than 960x540, by tuning two parameters it is
possible to obtain correct detection results.

Detecting x-corner can be done via several mathematical operators:

- Traditionally, corners are detected by localizing local maxima of Harris’s
  cornerness function, which collapses the structure tensor matrix as a score
  function [@HarrisS:1988:alvey].
- Likewise Forstner cornerness approach will give the strongest response in
  points that are most orthogonal to local gradients, and is in this regards
  related to Harris’s cornerness function.
- Another approach is to view x-corner as a saddle point which the Hessian
  operator responds as a local minima Geiger et al. suggest to construct
  template filter which x-corners would respond maximally.
- Abeles designed a faster corner detector than Harris.

I have decided to stick with Harris’s classical cornerness operator. It is very versatile and also works for deltille based pattern, aka monkey saddle-point. I have found it to be robust and sufficiently accurate if we set the parameters with care.

#### Recovery of the Grid Structure

### Mathematical Optimization Method

Similar to the bundle adjustment, the mathematical optimization consists in minimizing the reprojection of the 3D points of the chessboard x-corners to the camera image plane.

One first difficulty is to first initialize the pose of the chessboard plane with respect to the camera frame. The initialization of the rotation and position of the chessboard is necessary to avoid the optimizer being stuck in a bad local minimum.
